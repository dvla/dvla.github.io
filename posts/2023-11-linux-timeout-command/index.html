<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linux timeout command | DVLA Engineering</title><meta name=keywords content="Drone,Testing,AWS,Today I Learned"><meta name=description content="Ensuring a stale drone step is timed out"><meta name=author content="Paul Lewis"><link rel=canonical href=https://dvla.github.io/posts/2023-11-linux-timeout-command/><link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://dvla.github.io/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dvla.github.io/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dvla.github.io/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://dvla.github.io/favicon/apple-touch-icon.png><link rel=mask-icon href=https://dvla.github.io/favicon/favicon-16x16.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-WH4N9FEEE8"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-WH4N9FEEE8",{anonymize_ip:!1})}</script><meta property="og:title" content="Linux timeout command"><meta property="og:description" content="Ensuring a stale drone step is timed out"><meta property="og:type" content="article"><meta property="og:url" content="https://dvla.github.io/posts/2023-11-linux-timeout-command/"><meta property="og:image" content="https://dvla.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-14T00:00:00+00:00"><meta property="article:modified_time" content="2023-10-14T00:00:00+00:00"><meta property="og:site_name" content="DVLA Engineering"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dvla.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Linux timeout command"><meta name=twitter:description content="Ensuring a stale drone step is timed out"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dvla.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Linux timeout command","item":"https://dvla.github.io/posts/2023-11-linux-timeout-command/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Linux timeout command","name":"Linux timeout command","description":"Ensuring a stale drone step is timed out","keywords":["Drone","Testing","AWS","Today I Learned"],"articleBody":"When a drone build is configured to both deploy and then delete AWS services, it is vital the AWS clean up step runs to maintain the AWS stacks within their limit.\nTo ensure these steps run before the build times out, you can wrap your cucumber command in the linux timeout command within the drone pipeline\nexample:\ncommands: - cd functional-tests || exit 1 - timeout -k 10 10m bundle exec rake test Linux Timeout The timeout command is a command-line utility that will run the specified command for a given period of time, once that period of time is reached if the given command is still running it will be terminated.\ntimeout command:\ntimeout [OPTIONS] DURATION COMMAND [ARG]… Duration The duration is an integer followed by one of the following units, if no unit is used then it defaults to seconds:\ns - seconds (default) m - minutes h - hours d - days Signal flag If no signal is given, timeout sends the SIGTERM signal to the managed command when the time limit is reached. You can specify which signal to send using the -s (–signal) option.\nKill-after flag To ensure the command is killed, you can use the -k (–kill-after) flag with a specified time period. When the time limit is reached, the timeout command will then send the SIGKILL signal.\nPreserve-status flag There is a preserved status flag that can be passed in, when this is used timeout will always returns 124 if it times out.\nConclusion Prior to introducing this command into our pipelines, we had many drone build failures where, for a variety or reasons, the functional test step would hang and the build would time out, our ‘AWS clean up step’ would not execute and this resulted requiring manual intervention to clean them up (before we exceed our capacity).\nSince the introduction of this command we have seen a marked reduction in our drone builds timing out and not clearing down our AWS stacks.\n","wordCount":"331","inLanguage":"en","datePublished":"2023-10-14T00:00:00Z","dateModified":"2023-10-14T00:00:00Z","author":{"@type":"Person","name":"Paul Lewis"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dvla.github.io/posts/2023-11-linux-timeout-command/"},"publisher":{"@type":"Organization","name":"DVLA Engineering","logo":{"@type":"ImageObject","url":"https://dvla.github.io/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dvla.github.io/ accesskey=h title="DVLA Engineering (Alt + H)"><img src=https://dvla.github.io/favicon/apple-touch-icon.png alt aria-label=logo height=49>DVLA Engineering</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://dvla.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://dvla.github.io/open-source/ title=Open-source><span>Open-source</span></a></li><li><a href=https://github.com/dvla/ title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.civil-service-careers.gov.uk/departments/working-for-the-driver-and-vehicle-licensing-agency/ title=Careers><span>Careers</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dvla.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://dvla.github.io/posts/>Posts</a></div><h1 class=post-title>Linux timeout command</h1><div class=post-description>Ensuring a stale drone step is timed out</div><div class=post-meta><span title='2023-10-14 00:00:00 +0000 UTC'>October 14, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;331 words&nbsp;·&nbsp;Paul Lewis</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#linux-timeout>Linux Timeout</a><ul><li><a href=#duration>Duration</a></li><li><a href=#signal-flag>Signal flag</a></li><li><a href=#kill-after-flag>Kill-after flag</a></li><li><a href=#preserve-status-flag>Preserve-status flag</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details></div><div class=post-content><p>When a drone build is configured to both deploy and then delete AWS services, it is vital the AWS clean up step runs to maintain
the AWS stacks within their limit.</p><p>To ensure these steps run before the build times out, you can wrap your cucumber command in the linux timeout command within the drone pipeline</p><p>example:</p><pre tabindex=0><code>commands:
    - cd functional-tests || exit 1
    - timeout -k 10 10m bundle exec rake test
</code></pre><h2 id=linux-timeout>Linux Timeout<a hidden class=anchor aria-hidden=true href=#linux-timeout>#</a></h2><p>The timeout command is a command-line utility that will run the specified command for a given period of time, once that period of time is reached
if the given command is still running it will be terminated.</p><p>timeout command:</p><pre tabindex=0><code>timeout [OPTIONS] DURATION COMMAND [ARG]…
</code></pre><h3 id=duration>Duration<a hidden class=anchor aria-hidden=true href=#duration>#</a></h3><p>The duration is an integer followed by one of the following units, if no unit is used then it defaults to seconds:</p><ul><li>s - seconds (default)</li><li>m - minutes</li><li>h - hours</li><li>d - days</li></ul><h3 id=signal-flag>Signal flag<a hidden class=anchor aria-hidden=true href=#signal-flag>#</a></h3><p>If no signal is given, timeout sends the SIGTERM signal to the managed command when the time limit is reached. You can specify which signal to send
using the -s (&ndash;signal) option.</p><h3 id=kill-after-flag>Kill-after flag<a hidden class=anchor aria-hidden=true href=#kill-after-flag>#</a></h3><p>To ensure the command is killed, you can use the -k (&ndash;kill-after) flag with a specified time period. When the time limit is reached, the timeout command
will then send the SIGKILL signal.</p><h3 id=preserve-status-flag>Preserve-status flag<a hidden class=anchor aria-hidden=true href=#preserve-status-flag>#</a></h3><p>There is a preserved status flag that can be passed in, when this is used timeout will always returns 124 if it times out.</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>Prior to introducing this command into our pipelines, we had many drone build failures where, for a variety or reasons, the functional test step would hang and the
build would time out, our &lsquo;AWS clean up step&rsquo; would not execute and this resulted requiring manual intervention to clean them up (before we exceed our capacity).</p><p>Since the introduction of this command we have seen a marked reduction in our drone builds timing out and not clearing down our AWS stacks.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dvla.github.io/tags/drone/>Drone</a></li><li><a href=https://dvla.github.io/tags/testing/>Testing</a></li><li><a href=https://dvla.github.io/tags/aws/>AWS</a></li><li><a href=https://dvla.github.io/tags/today-i-learned/>Today I Learned</a></li></ul><nav class=paginav><a class=prev href=https://dvla.github.io/posts/2023-11-artefacts-and-atlas/><span class=title>« Prev</span><br><span>Artefacts in tests and managing them with Atlas</span></a>
<a class=next href=https://dvla.github.io/posts/2023-08-at-exit-hook/><span class=title>Next »</span><br><span>The at_exit function</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://dvla.github.io/>DVLA Engineering</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>